'use strict';

class AWSOktaAuthorizer {
  constructor(oktaService, stsService, credentialsHelper) {
    this._stsService = stsService;
    this._oktaService = oktaService;
    this._credentialsHelper = credentialsHelper;
  }
  Authorize(username, password, mfa, accountUrl) {
    return this._oktaService.generateSamlResponse(username, password, mfa, accountUrl)
      .then(decodedSamlResponse => this._stsService.getSTSToken(decodedSamlResponse)
        .then(data => this._credentialsHelper.writeAwsCredentialsToFile(data)))
      .then(() => 'Run complete');
  }
}

module.exports = AWSOktaAuthorizer;
