'use strict';

const AWS = require('aws-sdk');
const OktaService = require('./okta-service');
const StsService = require('./sts-service');
const credentialsHelper = require('./credentials-helper');
const AWSOktaAuthorizer = require('./aws-okta-authorizer');

class Root {
  static compose(config) {
    AWS.config.update({ region: 'us-east-1' });
    const AwsSTS = new AWS.STS({ apiVersion: '2011-06-15' });
    const stsService = new StsService(AwsSTS, config.sts.tokenValidityDuration);
    const oktaService = new OktaService();
    const awsOktaAuthorizer = new AWSOktaAuthorizer(oktaService, stsService, credentialsHelper);
    return { awsOktaAuthorizer };
  }
}

module.exports = Root;
