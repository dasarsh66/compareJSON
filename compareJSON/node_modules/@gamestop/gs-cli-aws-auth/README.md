# @gamestop/gs.cli.aws-auth [see changelog][CHANGELOG]

Command line utility to authenticate to AWS via OKTA

## Pre-requisite

NodeJS version 8.0.0 or higher

Mac

```sh
brew install node
```

Windows

```sh
choco install nodejs
```

## Installation

To install the application, make sure you have [NodeJs](https://nodejs.org/en/download/) installed and make sure you are [locally configured to pull npm packages from GameStop's artifactory instance](https://gamestop.atlassian.net/wiki/spaces/AA/pages/65599357/NPM+Local+Development+Setup), then install this npm package globally.

```bash
npm install -g @gamestop/gs-cli-aws-auth
```

## Usage

Simply type `awsauth` (or `aa` for short) on your command line. The program will prompt you for your credentials and allow you to select the aws environment to which you will authenticate. After authentication, your credentials are written to the `default` section of your ~/.aws/credentials file. In addition, the AWS authentication environment variables are created and you are placed into a new bash shell with those environment variables set. The environment variables can be passed into docker containers so that you can authenticate to aws inside the container.

If you have recently set your credentials and you then open a new shell (where the environment variables won't be set), you can use the `--no-auth` (or `-a` for short) option to reset the AWS environment variables based on your ~/.aws/credentials file without going through the authentication process again.

```bash
aa -a
```

If you'd like to only update your ~/.aws/credentials file without updating environment variables and starting a new shell, use the `--no-env` (or `-e` for short) option.

```bash
aa -e
```

NOTE: repeated runs of this program will continue to open new shells. It is good practice to `exit` the current shell before running the program again, though it isn't absolutely necessary.

NOTE: currently everyone is set up as owners in your sandbox environments. Owners can only have an STS token for a maximum of 1 hour so you'll need to rerun this program every hour for now.

## Development

[Visual Studio Code] is the recommended editor, though you are free to use what you like. The project is set
up to make life easy for VS Code-wielding developers.

To pass muster for deployment, the code must pass through the [ESLint] gauntlet. We are using a slightly relaxed
variant of the [air-bnb] ruleset.

## Deployment

The application is deployed to GameStop's artifactory npm repository in the @gamestop scope. Currently, this process is run by CodePipeline and CodeBuild. The pipeline is defined in the [Tools Pipelines Repository](https://github.com/GameStopCorp/gs.aws.pipelines.tools). Do not publish to npm from your development machine--you shouldn't have rights to do so anyway.

When you make a change, edit your package.json version property to a new semver version with a prerelease suffix (e.g. 1.1.14-beta.1). The build pipeline will notice the format of the version and tag the npm release with the first word after the dash for prerelease versions (in this case, 'beta'). After you have tested the prerelease version, once again edit the version property of the package.json file to remove the prerelease suffix and push your changes once more. The pipeline will re-publish using the 'latest' tag.

[CHANGELOG]: ./CHANGELOG.md
[Visual Studio Code]: https://code.visualstudio.com/
[ESLint]: http://eslint.org/
[air-bnb]: https://github.com/airbnb/javascript
